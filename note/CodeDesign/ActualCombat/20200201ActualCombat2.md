## 实战2
### 项目背景
我们希望设计开发一个小的框架，能够获取接口调用的各种统计信息，比如，响应时间的最大值（max）、最小值（min）、平均值（avg）、百分位值（percentile）、接口调用次数（count）、频率（tps） 等，并且支持将统计结果以各种显示格式（比如：JSON 格式、网页格式、自定义显示格式等）输出到各种终端（Console 命令行、HTTP 网页、Email、日志文件、自定义输出终端等），以方便查看。
### 需求分析
从以下两方面来做需求分析
1. 功能型需求分析
- 接口统计信息：包括接口响应时间的统计信息，以及接口调用次数的统计信息等。
- 统计信息的类型：max、min、avg、percentile、count、tps 等。
- 统计信息显示格式：Json、Html、自定义显示格式。
- 统计信息显示终端：Console、Email、HTTP 网页、日志、自定义显示终端。

除此之外，还有几个隐藏需求
- 统计触发方式：包括主动和被动两种。主动表示以一定的频率定时统计数据，并主动推送到显示终端，比如邮件推送。被动表示用户触发统计，比如用户在网页中选择要统计的时间区间，触发统计，并将结果显示给用户。
- 统计时间区间：框架需要支持自定义统计时间区间，比如统计最近 10 分钟的某接口的 tps、访问次数，或者统计 12 月 11 日 00 点到 12 月 12 日 00 点之间某接口响应时间的最大值、最小值、平均值等。
- 统计时间间隔：对于主动触发统计，我们还要支持指定统计时间间隔，也就是多久触发一次统计显示。比如，每间隔 10s 统计一次接口信息并显示到命令行中，每间隔 24 小时发送一封统计信息邮件。
2. 非功能性需求分析
- 易用性：是否容易集成，易插拔，松解耦，接口是否灵活等
- 性能：低延迟，内存消耗不能过大
- 扩展性：使用者不用在修改框架源码的基础上为框架扩展新功能。
- 容错性：对可能出现的异常和错误进行拦截捕获，前面考虑各种异常情况
- 通用性：灵活运用到其他场景中

### 框架设计
可以借鉴TDD(测试驱动开发)和prototype(最小原型)思想，先聚焦一个简单的场景，再继续迭代。

对于性能计数器来说，先聚焦到一个非常具体的、简单的应用场景，实现起来难度就降低很多。
```
//应用场景：统计下面两个接口(注册和登录）的响应时间和访问次数
public class UserController {
  public void register(UserVo user) {
    //...
  }
  
  public UserVo login(String telephone, String password) {
    //...
  }
}
```
