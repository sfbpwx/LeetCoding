## 实战1
### 项目内容
我通过一个积分兑换系统的开发实战，一方面给你展示一个业务系统从需求分析到上线维护的整个开发套路，让你能举一反三地应用到所有其他系统的开发中，另一方面也给你展示在看似没有技术含量的业务开发中，实际上都蕴含了哪些设计原则、思想、模式。
### 需求分析
积分是一种常见的营销手段，很多产品都会通过它来促进消费、增加用户粘性，比如淘宝积分、信用卡积分、商场消费积分等等。假设你是一家类似淘宝这样的电商平台的工程师，平台暂时还没有积分系统。Leader 希望由你来负责开发这样一个系统，你会如何来做呢？

积分系统无外乎两个大的功能点：
- 赚取积分
- 消费积分
具体内容如下：
#### 积分赚取和兑换规则
渠道包括：下订单、每日签到、评论等

积分规则可以比较通用，也可以比较细化。对于积分的有效期，我们可以根据不同的渠道，设置不同的有效期，积分到期后作废。在消费积分时，优先使用快到期的积分。
#### 积分消费和兑换规则
渠道包括：抵扣订单金额、兑换优惠券、积分换周、参与活动扣分等

我们可以根据不同的消费渠道设置不同的积分兑换规则
#### 积分及其明细查询
查询用户的总积分，赚取积分和消费积分的历史记录。
### 系统设计
#### 合理地将功能划分道不同模块
面向对象设计的本质就是把合适的代码放到合适的类中。

系统设计实际就是将合适的功能放到合适的模块中。合理的划分模块也可以做到模块层面的高内聚，低耦合，架构整洁清晰。
1. 积分赚取渠道及兑换规则、消费渠道及兑换规则的管理和维护（增删改查），不划分到积分系统中，而是放到更上层的营销系统中。这样积分系统就会变得非常简单，只需要负责增加积分、减少积分、查询积分、查询积分明细等这几个工作。
2. 积分赚取渠道及兑换规则、消费渠道及兑换规则的管理和维护，分散在各个相关业务系统中，比如订单系统、评论系统、签到系统、换购商城、优惠券系统等。还是刚刚那个下订单赚取积分的例子，在这种情况下，用户下订单成功之后，订单系统根据商品对应的积分兑换比例，计算所能兑换的积分数量，然后直接调用积分系统给用户增加积分。
3. 所有的功能都划分到积分系统中，包括积分赚取渠道及兑换规则、消费渠道及兑换规则的管理和维护。还是同样的例子，用户下订单成功之后，订单系统直接告知积分系统订单交易成功，积分系统根据订单信息查询积分兑换规则，给用户增加积分。


#### 设计模块与模块之间的交互关系
比较常见的系统之间的交互方式有两种，一种是同步接口调用，另一种是利用消息中间件异步调用。第一种方式简单直接，第二种方式的解耦效果更好。
#### 设计模块的接口、数据库、业务模型
