## 开闭原则
### 如何理解“对扩展开放、修改关闭”
开闭原则全称是Open Closed Principe 简称OCP
#### 详细解释
开闭原则就是增强代码的可扩展性，降低代码的修改特性。通过对不同的参数进行封装重构。
将参数设置和逻辑设置隔离开。运用扩展的方式对新加入的参数和逻辑进行添加，从而避免
修改旧代码可能会出现的问题。
### 修改代码就意味着违背开闭原则吗？
#### 往APIStatInfo类中添加新的属性类timeoutCount
在这个类中不光添加了timeoutCount，还增加了对应的setter/getter方法，这个问题就转换成
：往类中添加新的属性和方法，算作“修改”还是“扩展”？

同一个代码改动，在粗粒度代码中，可能会被认定为“修改”，在细粒度的代码中可能会被认为
是“扩展”。

比如改动一，添加属性和方法相当于修改类，在类的这个层面，这个代码可以被认定为“修改”，但是这个代码改动
并没有影响已有的属性和方法，在方法（以及属性）的层面，又可被认定为“扩展”。

这条原则的设计初衷，**只要他没有破坏原有代码的正常运行，没有破坏原有的单元测试，我们就可以说，
这是一个合格的代码改动。**

#### 在Applicationcontext类的initializebeans()方法中往alert对象中注册新的timeoutAlertHandler。
#### 在使用Alert类得实惠，需要往check()函数的入参APIStatInfo对象设置timeoutCount的值

这两个改动，不管在哪个层面，都是地地道道的修改，而非扩展。但是有些修改是在所难免且可以被接受的。

我们要认识到，添加一个新功能，不可能任何模块、类、方法的代码都不需要“修改”，这是做不到的。我们要做的是
尽量让修改操作更集中，更少，更上层，尽量让最核心，最复杂的那部分逻辑代码满足开闭原则。

### 如何做到“对扩展开放、修改关闭”
实际上，开闭原则讲的就是代码的扩展性问题，是判断一段代码是否易扩展的“金标准”。

再讲具体方法论之前，我们先来看一些更加偏向顶层的指导思想，为了尽量写出扩展型号的代码，我们要时刻具备扩展意识、抽象意识、封装医师，这些“潜意识”可能比任何开发技巧都重要。

### 开闭原则的具体方法论
#### 如何利用多态、依赖注入、基于接口而非实现编程
比如，我们代码中通过 Kafka 来发送异步消息。对于这样一个功能的开发，我们要学会将其抽象成一组跟具体消息队列（Kafka）无关的异步消息接口。所有上层系统都依赖这组抽象的接口编程，并且通过依赖注入的方式来调用。当我们要替换新的消息队列的时候，比如将 Kafka 替换成 RocketMQ，可以很方便地拔掉老的消息队列实现，插入新的消息队列实现。具体代码如下所示：
```
// 这一部分体现了抽象意识
public interface MessageQueue { //... }
public class KafkaMessageQueue implements MessageQueue { //... }
public class RocketMQMessageQueue implements MessageQueue {//...}

public interface MessageFormatter { //... }
public class JsonMessageFormatter implements MessageFormatter {//...}
public class MessageFormatter implements MessageFormatter {//...}

public class Demo {
  private MessageQueue msgQueue; // 基于接口而非实现编程
  public Demo(MessageQueue msgQueue) { // 依赖注入
    this.msgQueue = msgQueue;
  }
  
  // msgFormatter：多态、依赖注入
  public void sendNotification(Notification notification, MessageFormatter msgFormatter) {
    //...    
  }
}
```
### 如何在项目中灵活的应用开闭原则？
- 比较合理的做法：对于一些比较确定，短期内可能就会扩展或者需求改动对代码影响比较大，或者实现成本不高的扩展点，
在编写代码的时候我们就可以是先做这些扩展设计。
- 但是对于一些不确定未来是否要支持的需求，或者实现起来比较复杂的扩展点，我们可以等到由需求驱动的时候，再通过重构代码的方式来支持扩展的需求。

### 开闭原则也不是完全免费的
开闭原则会影响代码的可读性。

## 总结
### 如何做到“对扩展开放、修改关闭”
- 我们要时刻具备扩展意识、抽象意识、封装意识。在写代码的时候，我们要多花点时间思考一下，这段代码未来可能有哪些需求变更，如何设计代码结构，事先留好扩展点，以便在未来需求变更的时候，在不改动代码整体结构、做到最小代码改动的情况下，将新的代码灵活地插入到扩展点上。

- 很多设计原则、设计思想、设计模式，都是以提高代码的扩展性为最终目的的。特别是 23 种经典设计模式，大部分都是为了解决代码的扩展性问题而总结出来的，都是以开闭原则为指导原则的。最常用来提高代码扩展性的方法有：多态、依赖注入、基于接口而非实现编程，以及大部分的设计模式（比如，装饰、策略、模板、职责链、状态）。